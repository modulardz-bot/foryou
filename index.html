<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Memories - D</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background-color: #000;
      color: #e0e0e0;
      font-family: monospace;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      overflow-x: hidden;
    }

    .shooting-star {
      position: absolute;
      width: 4px;
      height: 4px;
      background: white;
      border-radius: 50%;
      top: 0;
      left: 0;
      box-shadow:
        0 0 8px #fff,
        0 0 15px #a29bfe,
        0 0 25px #fd79a8,
        -5px -5px 15px rgba(255,255,255,0.3);
      animation: shoot 1.5s ease-out forwards;
      opacity: 0.95;
      z-index: 1;
    }

    @keyframes shoot {
      0% { transform: translate(0, 0) scale(1); opacity: 1; }
      100% { transform: translate(600px, 400px) scale(0.9); opacity: 0; }
    }

    .stars {
      position: fixed;
      width: 100%;
      height: 100%;
      background: transparent;
      z-index: -1;
      overflow: hidden;
    }

    .star {
      position: absolute;
      width: 2px;
      height: 2px;
      background: white;
      border-radius: 50%;
      box-shadow:
       0 0 4px #a29bfe,
       0 0 8px #81ecec,
       0 0 12px #fd79a8,
       0 0 16px #a29bfe,
       0 0 20px #81ecec;
      animation: blink 2s infinite ease-in-out alternate;
    }

    @keyframes blink {
      0%, 100% { opacity: 0.1; }
      50% { opacity: 1; }
    }

    .container {
      width: 95%;
      max-width: 820px;
      padding: 40px;
      border-radius: 12px;
      background: rgba(18, 18, 18, 0.60);
      box-shadow: 0 0 16px rgba(255, 255, 255, 0.15);
      position: relative;
      text-align: center;
      z-index: 10;
    }

    h1 {
      color: #ff7675;
      margin-bottom: 20px;
    }

    .media-player {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 30px;
    }

    .media-player p {
      margin-bottom: 8px;
      color: #aaa;
      font-size: 1.2em;
    }

    .progress-container {
      width: 100%;
      max-width: 400px;
      height: 8px;
      background-color: #555;
      border-radius: 5px;
      cursor: pointer;
      margin: 10px 0;
      position: relative;
    }

    .progress {
      height: 100%;
      background-color: #ff7675;
      width: 0%;
      border-radius: 5px;
    }

    .time {
      font-size: 0.9em;
      color: #ccc;
      margin-top: 4px;
    }

    input[type="password"] {
      padding: 10px;
      width: 160px;
      margin-bottom: 20px;
      border: none;
      border-radius: 6px;
      background-color: #2d2d2d;
      color: #fff;
      font-size: 16px;
      font-family: monospace;
      text-align: center;
    }

    button {
      padding: 16px 28px;
      background-color: #ff7675;
      border: none;
      border-radius: 8px;
      color: #000;
      font-size: 1.10em;
      cursor: pointer;
      transition: 0.3s ease;
      margin: 5px;
      font-family: monospace;
    }

    .navigasi {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 30px;
      flex-wrap: wrap;
    }

    .navigasi button:hover {
      background-color: #0984e3;
    }

    .layer {
      display: none;
      white-space: pre-wrap;
      word-wrap: break-word;
      animation: fadeIn 0.6s ease-in-out forwards;
      text-align: left;
    }

    .active {
      display: block;
    }

    .hidden {
      display: none;
    }

    .dashboard-text {
      display: flex;
      justify-content: center;
      align-items: center;
      text-align: center;
      margin: 0 auto 25px;
      max-width: 100%;
      padding: 0 10px;
      flex-direction: column;
    }

    .dashboard-text pre {
      font-size: 1.6em;
      line-height: 1.6;
      text-align: center;
      white-space: pre-warp;
    }

    .timestamper {
      font-size: 1em;
      color: #aaa;
      margin-top: 8px;
      text-align: right;
      font-style: italic;
    }

    .halaman-indikator {
      font-size: 0.95em;
      text-align: center;
      margin-top: 10px;
      color: #888;
      font-style: italic;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .notif-penutup {
      text-align: center;
      font-size: 1.1em;
      color: #ff7675;
      font-style: italic;
      margin-bottom: 25px;
    }

    .ily-text {
      display: block;
      margin-top: 5px;
      color: #ccc;
    }

    #counter {
      font-size: 1.4em;
      font-weight: bold;
      color: #ccc;
      margin-top: 15px;
    }

    .galeri-mantan {
      column-count: 3;
      column-gap: 10px;
      margin-top: 25px;
    }

    .galeri-mantan img.foto-besar {
      width: 200%;
      margin-bottom: 10px;
      border-radius: 8px;
      display: block;
      object-fit: contain;
      background-color: #111;
      box-shadow: 0 0 6px rgba(255, 255, 255, 0.1);
      break-inside: avoid;
      cursor: zoom-in;
    }

    @media (max-width: 768px) {
      .galeri-mantan {
        column-count: 2;
      }
    }

    @media (max-width: 480px) {
      .galeri-mantan {
        column-count: 1;
      }
    }

    .lightbox {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.9);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 999;
    }
    .lightbox img {
      max-width: 90%;
      max-height: 90%;
      object-fit: contain;
      border-radius: 10px;
      box-shadow: 0 0 10px #fff;
    }
    .lightbox.active {
      display: flex;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Memories - D</h1>

    <div class="media-player">
      <p>üéµ Cardigan - Taylor Swift</p>
      <div>
        <button onclick="playMusik()">‚ñ∂ Play</button>
        <button onclick="pauseMusik()">‚è∏ Pause</button>
      </div>
      <div class="progress-container" onclick="setProgress(event)">
        <div class="progress" id="progressBar"></div>
      </div>
      <div class="time" id="timeDisplay">0:00 / 0:00</div>
    </div>

    <audio id="audio" src="cardigan.mp3" preload="auto" loop></audio>

    <div id="loginSection">
      <p>Ketikkan sesuatu untuk membuka halaman.</p>
      <input type="password" id="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
      <br>
      <button onclick="bukaSurat()">Masuk</button>
      <p id="errorMsg" style="color:#d63031; display:none;">Salah. Coba lagi.</p>
    </div>

    <div id="suratSection" class="hidden">
      <p id="counter"></p>

      <div class="layer active" id="dashboardSurat">
        <div class="dashboard-text">
          <div id="logoLoading" class="pigeon-run">üïäÔ∏è</div>
          <pre id="asciiNotifAnime" style="display:none; white-space:pre-wrap; text-align:center; font-size: 1.5;"></pre>
        </div>
        <div class="navigasi">
          <button id="btnBukaSurat" onclick="bukaSuratAsli()" disabled>üìñ Buka Surat</button>
          <button id="btnNanti" onclick="window.location.href='https://google.com'" disabled>‚ùå Nanti Saja</button>
        </div>
      </div>

      <div id="semuaHalaman"></div>
    </div>
  </div>

  <div id="lightbox" class="lightbox" onclick="this.classList.remove('active')">
    <img id="lightboxImg" src="">
  </div>

  <div class="stars"></div>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
<script>
  const passwordHash = "f09b133c45f78e374cd650c77229de1a5ea54dc4d2d3ca9bb1ddfe3c496f7939";
  const encryptedSurat = {
         halaman1: "Surat Halaman 1",
         suratTerakhir: "Isi Surat Terakhir"
  };

  function playMusik() {
    const audio = document.getElementById("audio");
    audio.play().catch(() => {});
  }

  function pauseMusik() {
    const audio = document.getElementById("audio");
    audio.pause();
  }

  document.getElementById("audio").addEventListener("timeupdate", updateProgress);
  document.getElementById("audio").addEventListener("loadedmetadata", updateProgress);

  function updateProgress() {
    const audio = document.getElementById("audio");
    const progress = document.getElementById("progressBar");
    const timeDisplay = document.getElementById("timeDisplay");
    const current = audio.currentTime;
    const duration = audio.duration;
    const percent = (current / duration) * 100;
    progress.style.width = percent + "%";

    const format = (t) => {
      const m = Math.floor(t / 60);
      const s = Math.floor(t % 60);
      return `${m}:${s < 10 ? "0" + s : s}`;
    };
    timeDisplay.textContent = `${format(current)} / ${format(duration)}`;
  }

  function setProgress(e) {
    const audio = document.getElementById("audio");
    const rect = e.currentTarget.getBoundingClientRect();
    const clickX = e.clientX - rect.left;
    const width = rect.width;
    const percent = clickX / width;
    audio.currentTime = audio.duration * percent;
  }

  let passwordYangBenar = "";

  async function bukaSurat() {
    const pass = document.getElementById("password").value;
    const encoder = new TextEncoder();
    const data = encoder.encode(pass);
    const hashBuffer = await crypto.subtle.digest("SHA-256", data);
    const hashArray = Array.from(new Uint8Array(hashBuffer));
    const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join("");

 if (hashHex === passwordHash) {
  passwordYangBenar = pass;
  document.getElementById("loginSection").classList.add("hidden");
  document.getElementById("suratSection").classList.remove("hidden");
  playMusik();
  hitungHari();
  gantiHalaman("dashboardSurat");

  setTimeout(() => {
    showAsciiAnime();
    document.getElementById("btnBukaSurat").disabled = false;
    document.getElementById("btnNanti").disabled = false;
  }, 3000);

  renderHalaman(pass);

  // ‚úÖ Preload galeri
  fetch("foto.json")
    .then(res => res.json())
    .then(data => {
      window.preloadedGaleri = data.map(e =>
        CryptoJS.AES.decrypt(e, pass).toString(CryptoJS.enc.Utf8)
      );
    });
} else {
  document.getElementById("errorMsg").style.display = "block";
}
}

function showAsciiAnime() {
  const notif = document.getElementById("asciiNotifAnime");
  const asciiText = `
üìú Haii orang yang selalu aku tunggu
(Di baco sampe abis yo hehe surat yang aku buat)

"Kalau kamu bisa baca ini,
berarti kamu berhasil membuka
surat terakhir dari orang yang belum pernah ninggalin kamu..."

üñ§ Surat ini diem-diem dijaga sejak hari pertama...
    dan cuma buat kamu.
    `;

  notif.style.display = "block";
  notif.textContent = "";
  let i = 0;
  function typingAnime() {
    if (i < asciiText.length) {
      notif.textContent += asciiText.charAt(i);
      i++;
      setTimeout(typingAnime, 45);
    }
  }
  typingAnime();
}

function gantiHalaman(n) {
  document.querySelectorAll(".layer").forEach(el => el.classList.remove("active"));
  const target = typeof n === 'string' ? document.getElementById(n) : document.getElementById("halaman" + n);
  if (target) target.classList.add("active");
}

function bukaSuratAsli() {
  gantiHalaman(1);
}

function hitungHari() {
  const awal = new Date("2025-06-24T00:30:00");
  const sekarang = new Date();
  const selisih = Math.floor((sekarang - awal) / (1000 * 60 * 60 * 24));
  document.getElementById("counter").textContent = `üìÖ Surat ini sudah disimpan selama ${selisih} hari.`;
}

function renderHalaman(kunci) {
  const container = document.getElementById("semuaHalaman");
  for (let i = 1; i <= 20; i++) {
    const key = "halaman" + i;
    if (!encryptedSurat[key]) continue;

    const div = document.createElement("div");
    div.classList.add("layer");
    div.id = key;

    const decrypted = CryptoJS.AES.decrypt(encryptedSurat[key], kunci).toString(CryptoJS.enc.Utf8);
    const p = document.createElement("p");
    p.textContent = decrypted;

    const timestamp = document.createElement("div");
    timestamp.className = "timestamper";
    timestamp.textContent = `üìÖ Dibuka pada ${new Date().toLocaleString("id-ID")}`;

    const indikator = document.createElement("div");
    indikator.className = "halaman-indikator";
    indikator.textContent = `üìñ Halaman ${i}`;

    const nav = document.createElement("div");
    nav.className = "navigasi";

    if (i > 1) {
      const back = document.createElement("button");
      back.textContent = "‚¨Ö Kembali";
      back.onclick = () => gantiHalaman(i - 1);
      nav.appendChild(back);
    }

    if (i < 20 && encryptedSurat["halaman" + (i + 1)]) {
      const next = document.createElement("button");
      next.textContent = "Lanjut ‚û°";
      next.onclick = () => gantiHalaman(i + 1);
      nav.appendChild(next);
    } else {
      const toLast = document.createElement("button");
      toLast.textContent = "üìú Surat Terakhir";
      toLast.onclick = () => bukaSuratTerakhir(kunci);
      nav.appendChild(toLast);
    }

    div.appendChild(p);
    div.appendChild(timestamp);
    div.appendChild(indikator);
    div.appendChild(nav);
    container.appendChild(div);
  }
}

function bukaSuratTerakhir(kunci) {
  const container = document.getElementById("semuaHalaman");
  container.querySelectorAll(".layer").forEach(el => el.classList.remove("active"));
  document.getElementById("suratTerakhirLayer")?.remove();

  const div = document.createElement("div");
  div.className = "layer active";
  div.id = "suratTerakhirLayer";

  const decrypted = CryptoJS.AES.decrypt(encryptedSurat.suratTerakhir, kunci).toString(CryptoJS.enc.Utf8);
  const p = document.createElement("p");
  p.textContent = decrypted;

  const timestamp = document.createElement("div");
  timestamp.className = "timestamper";
  timestamp.textContent = `üìÖ Dibuka pada ${new Date().toLocaleString("id-ID")}`;

  const notif = document.createElement("div");
  notif.className = "notif-penutup";
  notif.innerHTML = `üì© Surat telah dibaca sampai akhir.<br><span class="ily-text">Terima kasih. ily</span>`;

  const nav = document.createElement("div");
  nav.className = "navigasi";
  const kembaliBtn = document.createElement("button");
  kembaliBtn.textContent = "üè† Kembali ke Dashboard";
  kembaliBtn.onclick = () => {
    gantiHalaman("dashboardSurat");
  };
  nav.appendChild(kembaliBtn);

  div.appendChild(notif);
  div.appendChild(p);
  div.appendChild(timestamp);
  div.appendChild(nav);

  // ‚úÖ Inject Galeri (Auto foto besar)
  const decryptedImages = window.preloadedGaleri || [];
  if (decryptedImages.length) {
    const galeri = document.createElement("div");
    galeri.className = "galeri-mantan";

    decryptedImages.forEach(src => {
      const img = document.createElement("img");
      img.src = src;
      img.loading = "lazy";

      // ‚úÖ otomatis bikin besar jika base64 panjang
      if (src.length > 100000) {
        img.classList.add("foto-besar");
      }

      img.onclick = () => {
        document.getElementById("lightboxImg").src = src;
        document.getElementById("lightbox").classList.add("active");
      };

      galeri.appendChild(img);
    });

    div.appendChild(galeri);
  }

  container.appendChild(div);
}
</script>

<script>
function createShootingStar() {
  const star = document.createElement("div");
  star.className = "shooting-star";
  star.style.top = Math.random() * window.innerHeight * 0.4 + "px";
  star.style.left = Math.random() * window.innerWidth * 0.2 + "px";
  document.body.appendChild(star);
  setTimeout(() => star.remove(), 1800);
}

setInterval(() => {
  if (Math.random() < 0.4) createShootingStar();
}, 4500);

function createStars(jumlah = 120) {
  const starsContainer = document.querySelector(".stars");
  for (let i = 0; i < jumlah; i++) {
    const star = document.createElement("div");
    star.className = "star";
    star.style.top = `${Math.random() * 100}%`;
    star.style.left = `${Math.random() * 100}%`;
    star.style.animationDelay = `${Math.random() * 2}s`;
    starsContainer.appendChild(star);
  }
}

window.onload = () => {
  createStars();
};
</script>
</body>
</html>
